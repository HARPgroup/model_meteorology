dailyvarkey=$1
raster_sql_file=$2
db_host=$3
db_name=$4
start_date=-1
end_date=-1

if [ $# -gt 4 ]; then
  start_date=$5
fi

if [ $# -gt 5 ]; then
  end_date=$6
fi

if [ '$start_date' == '-1' ]; then
  start_epoch=-1
else
  start_epoch=$(date -d '$start_date' +%s)
fi

if [ '$end_date' == '-1' ]; then
  end_epoch=-1
else
  end_epoch=$(date -d '$end_date' +%s)
fi

echo "called daily_delete_ts $dailyvarkey $raster_sql_file $db_host $db_name $start_date $end_date"

deletedaily="
\\set dailyvarkeyID '$dailyvarkey' \n
\\set start_epoch $start_epoch \n
\\set end_epoch $end_epoch \n

delete from dh_timeseries_weather as data
using dh_variabledefinition as variables
where data.varid = variables.hydroid
  and variables.varkey = :'dailyvarkey'
  and ( (data.tsendtime >= :start_epoch) or (:start_epoch = -1) )
  and ( (data.tsendtime <= :end_epoch) or (:end_epoch = -1) )
;"

# turn off the expansion of the asterisk
set -f
echo -e $deletedaily > $raster_sql_file
#cat $raster_sql_file | psql -h $db_host $db_name
